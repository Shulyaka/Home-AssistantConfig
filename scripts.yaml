turn_off_tv:
  alias: Turn off TV
  sequence:
  - service: media_player.turn_off
    target:
      entity_id: media_player.philips_tv_3
  mode: single
recover_humidifier:
  alias: Recover humidifier
  sequence:
  - data:
      duration: 254
    action: zha.permit
  description: Fix humidifier connection
  icon: mdi:air-humidifier
lockdown:
  alias: Lockdown
  sequence:
  - action: notify.mobile_app_s23
    data:
      message: command_launch_app
      data:
        package_name: com.radefffactory.lockdown
  description: Lock Denis phone screen
  icon: mdi:cellphone-lock
start_vacuum:
  sequence:
  - action: neato.custom_cleaning
    metadata: {}
    data:
      mode: 2
      navigation: 1
      category: 4
      zone: '{{ zone }}'
    target:
      entity_id: vacuum.robot
  - stop: Done
    response_variable: result
  variables:
    result: Done
  fields:
    zone:
      selector:
        select:
          options:
          - label: Living room
            value: Living room
          - label: Kitchen
            value: Kitchen
          - label: Kitchen table
            value: Kitchen table
          - label: Around the kitchen table
            value: Around the table
          - label: Entryway
            value: Entryway
          - label: Cupboard in the living room
            value: Cupboard
          - label: Hallway
            value: Hallway
          - label: Bedroom
            value: Bedroom
          - label: Bed in master bedroom
            value: Main bed
          - label: Ksusha's table
            value: Ksusha's table
          - label: Denis' table
            value: Denis' table
          - label: Children room
            value: Kid's bedroom
          - label: Cupboard in Children room
            value: Under the kid's cupboard
          - label: Table in Children room
            value: Kid's table
          - label: Bed in Children room
            value: Kid's bed
      name: Zone
      description: Name of the zone to clean. Defaults to no zone i.e. complete house
        cleanup.
  alias: Start Vacuum
  description: Start vacuum robot cleaning in certain place
deep_research:
  sequence:
  - variables:
      query: '{% if query is defined %}{{ query }}{%- else -%}{{ state_attr("sensor.deep_research_results",
        "query") }}{%- endif %}'
  - event: deep_research_results
    event_data:
      query: '{{ query }}'
      result: Deep Research failed
  - action: conversation.process
    metadata: {}
    data:
      agent_id: conversation.deep_research
      text: '{{ query }}'
    response_variable: result
  - set_conversation_response: '{{ result.response.speech.plain.speech }}'
  - event: deep_research_results
    event_data:
      query: '{{ query }}'
      result: '{{ result.response.speech.plain.speech }}'
  - if:
    - condition: template
      value_template: '{{ result.response.response_type == ''error'' }}'
    then:
    - action: notify.persistent_notification
      metadata: {}
      data:
        message: '{{ result.response.speech.plain.speech }}'
        title: Deep Research
    - stop: '{{ result.response.speech.plain.speech }}'
      error: true
    alias: Exit on error
  - action: notify.persistent_notification
    metadata: {}
    data:
      message: Your deep research results are ready
      title: Deep Research
  fields:
    query:
      selector:
        text:
          multiline: true
      name: Query
      required: true
      description: Include every detail that matter for the research
  alias: Deep Research
  description: This script processes a query for deep research, notifying the user
    once the results are ready.
multivarka:
  sequence:
  - action: ready4sky.set_manual_program
    data:
      prog: '{{prog}}'
      subprog: '{{subprog or 0}}'
      temp: '{{temp}}'
      hours: '{{timer[''hours'']}}'
      minutes: '{{timer[''minutes'']}}'
      dhours: '{% if delay is defined %}{{delay[''hours'']}}{% else %}0{% endif %}'
      dminutes: '{% if delay is defined %}{{delay[''minutes'']}}{% else %}0{% endif
        %}'
      heat: '{{heat}}'
    target:
      entity_id: water_heater.rmc_m800s_cooker
  fields:
    prog:
      selector:
        select:
          options:
          - label: Мультиповар
            value: '0'
          - label: Рис, крупы
            value: '1'
          - label: Томление
            value: '2'
          - label: Плов
            value: '3'
          - label: Жарка
            value: '4'
          - label: Тушение
            value: '5'
          - label: Паста
            value: '6'
          - label: Молочная каша
            value: '7'
          - label: Суп
            value: '8'
          - label: Йогурт
            value: '9'
          - label: Выпечка
            value: '10'
          - label: Пар
            value: '11'
          - label: Варка бобовые
            value: '12'
      name: Program
      description: Меню
      default: '0'
      required: true
    subprog:
      selector:
        select:
          options:
          - label: Овощи
            value: '1'
          - label: Рыба
            value: '2'
          - label: Мясо
            value: '3'
      name: Subprogram
      description: Выбор продукта
    temp:
      selector:
        number:
          min: 30
          max: 180
      name: Temperature
      description: Температура
      default: 95
      required: true
    timer:
      selector:
        duration: {}
      name: Timer
      description: Таймер
      required: true
      default:
        hours: 1
        minutes: 15
        seconds: 0
    delay:
      selector:
        duration: {}
      name: Delay
      description: Задержка старта
      required: false
      default:
        hours: 0
        minutes: 0
        seconds: 0
    heat:
      selector:
        boolean: {}
      name: Heat
      description: Разогрев
      default: true
      required: true
  alias: Запустить мультиварку
  description: Run a selected program on the RMC_M800S cooker with temperature, duration,
    optional delay and keep-warm (heat) settings.
  icon: mdi:chef-hat
set_cooker_timer:
  sequence:
  - action: ready4sky.set_timer
    metadata: {}
    data:
      hours: '{{timer[''hours'']}}'
      minutes: '{{timer[''minutes'']}}'
    target:
      entity_id: water_heater.rmc_m800s_cooker
  fields:
    timer:
      selector:
        duration: {}
      name: Timer
      description: Таймер
      required: true
      default:
        hours: 0
        minutes: 30
        seconds: 0
  alias: Set Cooker Timer
  description: ''
  icon: mdi:timer-settings
generate_image_2:
  sequence:
  - variables:
      prompt: '{{ prompt if prompt not in (''Repeat last prompt'', '''') else state_attr(''image.template_ai_generated_image'',
        ''friendly_name'') }}'
      entity: '{{ entity if entity != '''' else ''ai_task.openai_ai_task'' }}'
  - event: image_generated
    event_data:
      url: https://shulyaka.org.ru/local/generating_image_1024x1024_{{ [1, 2, 3, 4,
        5] | random }}.png
      revised_prompt: '{{ prompt }}'
  - if:
    - condition: template
      value_template: '{{ attachment is defined }}'
    then:
    - action: ai_task.generate_image
      metadata: {}
      data:
        task_name: Generate image
        instructions: '{{ prompt }}'
        entity_id: '{{ entity }}'
        attachments: '{{ attachment }}'
      response_variable: generated_image
    else:
    - action: ai_task.generate_image
      metadata: {}
      data:
        task_name: Generate image
        instructions: '{{ prompt }}'
        entity_id: '{{ entity }}'
      response_variable: generated_image
  - event: image_generated
    event_data:
      url: https://shulyaka.org.ru{{ generated_image.url }}
      revised_prompt: '{{ generated_image.revised_prompt }}'
  fields:
    prompt:
      selector:
        text:
          multiline: true
          multiple: false
      default: Repeat last prompt
      required: true
      name: Prompt
    entity:
      selector:
        entity:
          multiple: false
          filter:
            domain: ai_task
            supported_features:
            - ai_task.AITaskEntityFeature.GENERATE_IMAGE
      default: ai_task.openai_ai_task
      required: true
      name: Model
    attachment:
      selector:
        media:
          accept:
          - '*'
  alias: Generate Image
  description: ''
generate_image_for_telegram:
  sequence:
  - action: ai_task.generate_image
    metadata: {}
    data:
      instructions: '{{ prompt }}'
      task_name: Generate image for telegram
    response_variable: generated_image
  - action: telegram_bot.send_photo
    metadata: {}
    data:
      verify_ssl: true
      config_entry_id: 01JZ0Y93H64KQ6V7D1G88AF9BS
      url: https://shulyaka.org.ru{{ generated_image.url }}
      file: '{{ generated_image.media_source_id.replace("media-source:/", "/raid/data/photo")
        }}'
      caption: '{{ generated_image.revised_prompt }}'
      target: '{{ {''2adbd618c4f44e28ae091db107c59870'': ''114122164'', ''e46830ca0d344b8e8bfe897f376170b8'':
        ''1560910091'', ''49c6cba386e64e7ba7d380146f5a546c'': ''5891746911''}[context.user_id]
        }}'
  fields:
    prompt:
      selector:
        text:
      name: Prompt
      required: true
  alias: Generate image for Telegram
  description: Generate an image using AI and send to the user
