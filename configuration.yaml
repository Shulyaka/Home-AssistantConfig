
# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

#frontend:
#  development_repo: /usr/share/nas/other/home-assistant-polymer-prod

conversation:

bluetooth:

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
homeassistant:
  customize: !include customize.yaml
  media_dirs:
    video: /usr/share/nas/video
    photo: /usr/share/nas/photo
    music: /usr/share/nas/music

mqtt:

input_boolean:
  sleep_denis:
    name: Sleep state (Denis)
    icon: mdi:sleep
  sleep_ksenia:
    name: Sleep state (Ksenia)
    icon: mdi:sleep
  sleep_daria:
    name: Sleep state (Daria)
    icon: mdi:sleep
  fan_suppress:
    name: Fan Suppress
    initial: false
    icon: mdi:fan-off
  fan_suppress_long:
    name: Fan Suppress Long
    initial: false
    icon: mdi:fan-remove
  fan_force_on:
    name: Fan Force On
    initial: false
    icon: mdi:fan-plus

input_number:
  energy_saved:
    name: Energy Saved Value
    min: 0
    max: 999999
    step: 0.01
    mode: box
    unit_of_measurement: 'kWh'
    icon: mdi:lightning-bolt-outline
  energy_t1:
    name: Energy Saved Value T1
    min: 0
    max: 999999
    step: 0.01
    mode: box
    unit_of_measurement: 'kWh'
    icon: mdi:lightning-bolt-circle
  energy_t2:
    name: Energy Saved Value T2
    min: 0
    max: 999999
    step: 0.01
    mode: box
    unit_of_measurement: 'kWh'
    icon: mdi:lightning-bolt-circle
  energy_t3:
    name: Energy Saved Value T3
    min: 0
    max: 999999
    step: 0.01
    mode: box
    unit_of_measurement: 'kWh'
    icon: mdi:lightning-bolt-circle

http:
  use_x_forwarded_for: true
  trusted_proxies: 192.168.1.1
  cors_allowed_origins: https://shulyaka.org.ru

recorder:
  db_url: mysql+pymysql://@/hass_db?unix_socket=/opt/mysql/mysql.sock&charset=utf8

logger:
  default: debug
#  default: info
  logs:
    pyipp.parser: info
    haphilipsjs: info
    aiosqlite: info
    zeroconf: info
    mpd.base: info
    async_upnp_client.traffic: info
    async_upnp_client.advertisement: info
    homeassistant.helpers.storage: info
    homeassistant.components.sun: info
    homeassistant.components.ipp: info
    homeassistant.components.hue: info
    homeassistant.components.ssdp: info
    homeassistant.components.history: info
    homeassistant.components.recorder: info
    homeassistant.components.websocket_api: info
    homeassistant.components.webhook: info
    homeassistant.components.mobile_app.webhook: info
    homeassistant.components.http.auth: debug
    homeassistant.components.http.view: debug
    homeassistant.components.rest.sensor: info
    homeassistant.components.dlna_dmr.media_player: info
    homeassistant.components.shell_command: debug
    homeassistant.components.zha.core.channels.base: debug
    homeassistant.components.zha.core.device: debug
    homeassistant.components.zha.number: debug
    zigpy_xbee.zigbee.application: debug
    zigpy_xbee.uart: debug
    zigpy_xbee.api: debug
    zigpy.zcl: debug

google_assistant:
  project_id: home-assistant-1404b
#  api_key: !secret google_assistant
  service_account: !include service_account.json
  report_state: true
  entity_config:
    vacuum.robot:
      expose: false
    light.hue_color_candle_1:
      expose: false
    light.hue_color_candle_2:
      expose: false
    light.hue_color_candle_3:
      expose: false
    light.hue_color_candle_4:
      expose: false
    light.hue_color_candle_5:
      expose: false
    light.hue_color_candle_6:
      expose: false
    light.hue_color_candle_7:
      expose: false
    light.hue_color_candle_8:
      expose: false
    light.hue_color_lamp_1:
      expose: false
    light.hue_color_lamp_2:
      expose: false
    light.hue_color_lamp_5:
      expose: false
    light.hue_color_lamp_4:
      expose: false
    light.hue_color_spot_1:
      expose: false
    light.hue_color_spot_2:
      expose: false
    light.bathroom:
      expose: false
    light.children_room:
      expose: false
    light.custom_group_for_roombl:
      expose: false
    light.custom_group_for_roombl_2:
      expose: false
    light.custom_group_for_roombr:
      expose: false
    light.custom_group_for_roombr_2:
      expose: false
    light.custom_group_for_roomtl:
      expose: false
    light.custom_group_for_roomtl_2:
      expose: false
    light.custom_group_for_roomtr:
      expose: false
    light.custom_group_for_roomtr_2:
      expose: false
    light.kitchen:
      expose: false
    light.living_room:
      expose: false
    light.razvlecheniia_1:
      expose: false
    light.sleeping_room:
      expose: false
    switch.humidifier_pump:
      expose: false
    switch.humidifier_aux_led:
      expose: false
    switch.humidifier_fan:
      expose: false
    light.lumi_lumi_relay_c2acn01_2321e803_2:
      expose: false

alexa:
  smart_home:
    endpoint: https://api.amazonalexa.com/v3/events
    client_id: amzn1.application-oa2-client.a9df13cdb9ec4b5a8c0ff2cf941f782a
    client_secret: !secret alexa_client_secret
    filter:
      exclude_domains:
        - input_number
        - input_boolean
        - automation
        - group
      exclude_entity_globs:
        - light.hue_*
        - light.custom_group_for_room*
        - switch.humidifier_*
      exclude_entities:
        - light.bathroom
        - light.children_room
        - light.kitchen
        - light.living_room
        - light.sleeping_room
        - light.razvlecheniia_1
        - light.lumi_lumi_relay_c2acn01_2321e803_2
    entity_config:
      light.lumi_lumi_relay_fan:
        display_categories: FAN

yandex_smart_home:
  filter:
    exclude_domains:
      - input_number
      - input_boolean
      - automation
      - group
      - light
      - scene
      - button
    exclude_entities:
      - sensor.yandex_weather_feels_like_temperature
      - switch.humidifier_xbee_aux_led
      - switch.humidifier_xbee_fan
      - switch.humidifier_xbee_pump
      - switch.humidifier_pressure_drop_valve
      - switch.bedroom_humidifier_valve
      - switch.childrens_room_humidifier_valve
      - switch.living_room_humidifier_valve
      - switch.humidifier_aux_led
      - switch.humidifier_fan
      - switch.humidifier_pump
      - climate.humidifier_fan
      - sensor.lumi_lumi_weather_3bfcf003_temperature
      - sensor.lumi_lumi_weather_3bfcf003_humidity
      - sensor.lumi_lumi_sens_48945e02_temperature
      - sensor.lumi_lumi_sens_48945e02_power
      - sensor.lumi_lumi_sens_02fbebbd_1_1026
      - sensor.lumi_lumi_sens_02fbebbd_1_1029
      - sensor.humidifier_xbee_pressure_in_pct
      - sensor.humidifier_internal_temperature
      - sensor.humidifier_pump_temperature
      - sensor.humidifier_pressure_in
      - switch.adaptive_lighting_adapt_brightness_bathroom
      - switch.adaptive_lighting_adapt_brightness_children_room
      - switch.adaptive_lighting_adapt_brightness_living_room
      - switch.adaptive_lighting_adapt_color_bathroom
      - switch.adaptive_lighting_adapt_color_children_room
      - switch.adaptive_lighting_adapt_color_living_room
      - switch.adaptive_lighting_sleep_mode_bathroom
      - switch.adaptive_lighting_sleep_mode_children_room
      - switch.adaptive_lighting_sleep_mode_living_room
      - switch.adaptive_lighting_bathroom
      - switch.adaptive_lighting_children_room
      - switch.adaptive_lighting_living_room
      - sensor.sm_g970f_uroven_zariada_akkumuliatora
      - sensor.sm_g970f_battery_temperature
      - sensor.sm_g970f_atmosfernoe_davlenie
      - sensor.sm_g970f_datchik_osveshchionnosti
      - sensor.maxlumi2_battery_level_2
      - sensor.maxlumi2_battery_temperature_2
      - sensor.yota_battery_level
      - sensor.yota_battery_temperature
      - sensor.sm_t725_battery_level
      - sensor.sm_t725_battery_temperature
      - sensor.sm_t725_light_sensor
      - sensor.robot_battery
      - switch.digi_xbee3_b384d141_on_off
      - switch.digi_xbee3_b384d141_on_off_2
      - switch.digi_xbee3_b384d141_on_off_3
      - switch.digi_xbee3_b384d141_on_off_4
      - switch.digi_xbee3_b384d141_on_off_5
      - switch.digi_xbee3_b384d141_on_off_6
      - switch.digi_xbee3_b384d141_on_off_7
      - switch.digi_xbee3_b384d141_on_off_8
      - switch.digi_xbee3_b384d141_on_off_9
      - switch.digi_xbee3_b384d141_on_off_10
      - switch.digi_xbee3_b384d141_on_off_11
      - switch.digi_xbee3_b384d141_on_off_12
      - switch.digi_xbee3_b384d141_on_off_13
      - switch.digi_xbee3_b384d141_on_off_14
      - switch.digi_xbee3_b384d141_on_off_15
      - sensor.airthings_wave_082639_humidity
      - sensor.airthings_wave_082639_illuminance
      - sensor.airthings_wave_082639_pressure
      - sensor.airthings_wave_082639_temperature
      - sensor.airthings_wave_082639_vocs
      - sensor.airthings_wave_082639_battery
      - sensor.lumi_lumi_sen_ill_mgl01_e924773c_power
      - sensor.lumi_lumi_weather_3bfcf003_temperature
      - sensor.lumi_lumi_weather_3bfcf003_pressure
      - sensor.lumi_lumi_weather_3bfcf003_power
      - sensor.lumi_lumi_sensor_ht_agl02_humidity_2
      - sensor.lumi_lumi_sensor_ht_agl02_pressure_2
      - sensor.lumi_lumi_sensor_ht_agl02_temperature_2
      - sensor.lumi_lumi_sensor_ht_agl02_battery_2
      - sensor.lumi_lumi_sensor_ht_agl02_humidity_3
      - sensor.lumi_lumi_sensor_ht_agl02_pressure_3
      - sensor.lumi_lumi_sensor_ht_agl02_temperature_3
      - sensor.lumi_lumi_sensor_ht_agl02_battery_3
      - sensor.bedroom_humidity
      - sensor.lumi_lumi_sensor_magnet_aq2_a9733b03_device_temperature
      - sensor.lumi_lumi_sensor_magnet_aq2_033b73a9_1_1
      - sensor.lumi_lumi_weather_95169d01_temperature
      - sensor.lumi_lumi_weather_95169d01_pressure
      - sensor.lumi_lumi_weather_95169d01_power
      - sensor.aqara_lumi_motion_ac01_devicetemperature
      - sensor.lumi_lumi_sensor_wleak_aq1_035acf68_1_1
      - sensor.lumi_lumi_sensor_wleak_aq1_68cf5a03_device_temperature
      - sensor.lumi_lumi_sensor_wleak_aq1_power
      - sensor.lumi_lumi_sensor_wleak_aq1_058c7905_device_temperature
      - sensor.lumi_lumi_sensor_magnet_aq2_6b2b4205_power
      - sensor.lumi_lumi_sensor_magnet_aq2_6b2b4205_device_temperature
      - sensor.lumi_lumi_sensor_magnet_aq2_c4702205_power
      - sensor.lumi_lumi_sensor_magnet_aq2_c4702205_device_temperature
      - sensor.lumi_lumi_sensor_wleak_aq1_03580198_1_1
      - sensor.lumi_lumi_sensor_wleak_aq1_98015803_device_temperature
      - sensor.lumi_lumi_sensor_wleak_aq1_cbcc5703_power
      - sensor.lumi_lumi_sensor_wleak_aq1_cbcc5703_device_temperature
      - sensor.lumi_lumi_sen_ill_mgl01_3325773c_power
      - sensor.lumi_lumi_plug_maeu01_electrical_measurement
      - sensor.iolka_rms_voltage
      - sensor.lumi_lumi_plug_maeu01_fec8793c_device_temperature
      - sensor.lumi_lumi_relay_c2acn01_active_power
      - sensor.lumi_lumi_relay_c2acn01_rms_voltage
      - sensor.lumi_lumi_relay_c2acn01_device_temperature
      - sensor.lumi_lumi_sen_ill_mgl01_d952773c_power
      - sensor.lumi_lumi_sens_02fbebbd_1_1026
      - sensor.lumi_lumi_sens_02fbebbd_1_1
      - sensor.tze200_hkdl5fmv_ts0601_active_power
      - sensor.tze200_hkdl5fmv_ts0601_rms_voltage
      - sensor.tze200_hkdl5fmv_ts0601_rms_current
      - sensor.tze200_hkdl5fmv_ts0601_device_temperature
      - sensor.lumi_lumi_sensor_ht_agl02_humidity
      - sensor.lumi_lumi_sensor_ht_agl02_pressure
      - sensor.lumi_lumi_sensor_ht_agl02_battery
      - sensor.lumi_lumi_relay_c2acn01_2321e803_1_2820
      - sensor.lumi_lumi_relay_c2acn01_2321e803_device_temperature
      - sensor.air1_ultra_battery_level
      - sensor.maxlumi2_battery_power
      - sensor.lumi_lumi_sensor_wleak_aq1_0357ccbf_1_1
      - sensor.lumi_lumi_sensor_wleak_aq1_bfcc5703_device_temperature
      - sensor.sm_t725_battery_power
      - sensor.s23_battery_level
      - sensor.sm_g970f_battery_power
      - sensor.lumi_lumi_sensor_swit_bf40d402_1_1
      - sensor.lumi_lumi_sensor_switch_aq3_bf40d402_device_temperature
      - sensor.lumi_lumi_sen_ill_mgl01_7625773c_power
    include_entities:
      - light.philips_lct003_a93fdc04_level_light_color_on_off
      - light.lumi_lumi_relay_fan
      - light.bathroom_exhaust_lamp
      - light.lumi_lumi_relay_c2acn01_2321e803_2
      - light.lumi_lumi_relay_c2acn01_light
  notifier:
    - oauth_token: !secret yandex_smart_home_oauth_token
      skill_id: !secret yandex_smart_home_skill_id
      user_id: 2ce615b61c8545e8aa0a45ea2236ed74
  entity_config:
    humidifier.bedroom:
      modes:
        program:
          normal:
            - normal
          quiet:
            - away
      properties:
        - type: temperature
          entity: sensor.lumi_lumi_weather_3bfcf003_temperature
        - type: water_level
          entity: sensor.humidifier_xbee_pressure_in_pct
        - type: water_leak
          entity: binary_sensor.humidifier_leak
      custom_toggles:
        controls_locked:
          state_entity_id: switch.humidifier_pump_block
          turn_on:
            service: homeassistant.turn_on
            entity_id: switch.humidifier_pump_block
          turn_off:
            service: homeassistant.turn_off
            entity_id: switch.humidifier_pump_block
    humidifier.childrens_room:
      modes:
        program:
          normal:
            - normal
          quiet:
            - away
      properties:
        - type: temperature
          entity: sensor.lumi_lumi_sens_48945e02_temperature
        - type: water_level
          entity: sensor.humidifier_xbee_pressure_in_pct
        - type: water_leak
          entity: binary_sensor.humidifier_leak
    humidifier.living_room:
      modes:
        program:
          normal:
            - normal
          quiet:
            - away
      properties:
        - type: temperature
          entity: sensor.lumi_lumi_sens_02fbebbd_1_1026
        - type: water_level
          entity: sensor.humidifier_xbee_pressure_in_pct
        - type: water_leak
          entity: binary_sensor.humidifier_leak
    sensor.airthings_wave_082639_carbon_dioxide:
      properties:
        - type: co2_level
          entity: sensor.airthings_wave_082639_carbon_dioxide
        - type: humidity
          entity: sensor.airthings_wave_082639_humidity
        - type: illumination
          entity: sensor.airthings_wave_082639_illuminance
        - type: pressure
          entity: sensor.airthings_wave_082639_pressure
        - type: temperature
          entity: sensor.airthings_wave_082639_temperature
        - type: tvoc
          entity: sensor.airthings_wave_082639_vocs
        - type: battery_level
          entity: sensor.airthings_wave_082639_battery
    sensor.lumi_lumi_sen_ill_mgl01_e924773c_illuminance:
      properties:
        - type: illumination
          entity: sensor.lumi_lumi_sen_ill_mgl01_e924773c_illuminance
        - type: battery_level
          entity: sensor.lumi_lumi_sen_ill_mgl01_e924773c_power
    sensor.lumi_lumi_weather_3bfcf003_humidity:
      properties:
        - type: humidity
          entity: sensor.lumi_lumi_weather_3bfcf003_humidity
        - type: temperature
          entity: sensor.lumi_lumi_weather_3bfcf003_temperature
        - type: pressure
          entity: sensor.lumi_lumi_weather_3bfcf003_pressure
        - type: battery_level
          entity: sensor.lumi_lumi_weather_3bfcf003_power
    binary_sensor.lumi_lumi_sensor_magnet_aq2_033b73a9_1_6:
      properties:
        - type: open
          entity: binary_sensor.lumi_lumi_sensor_magnet_aq2_033b73a9_1_6
        - type: battery_level
          entity: sensor.lumi_lumi_sensor_magnet_aq2_033b73a9_1_1
    sensor.lumi_lumi_weather_95169d01_humidity:
      properties:
        - type: humidity
          entity: sensor.lumi_lumi_weather_95169d01_humidity
        - type: temperature
          entity: sensor.lumi_lumi_weather_95169d01_temperature
        - type: pressure
          entity: sensor.lumi_lumi_weather_95169d01_pressure
        - type: battery_level
          entity: sensor.lumi_lumi_weather_95169d01_power
    binary_sensor.lumi_lumi_sensor_wleak_aq1_035acf68_1_1280:
      properties:
        - type: water_leak
          entity: binary_sensor.lumi_lumi_sensor_wleak_aq1_035acf68_1_1280
        - type: battery_level
          entity: sensor.lumi_lumi_sensor_wleak_aq1_035acf68_1_1
    binary_sensor.lumi_lumi_sensor_wleak_aq1_058c7905_ias_zone:
      properties:
        - type: water_leak
          entity: binary_sensor.lumi_lumi_sensor_wleak_aq1_058c7905_ias_zone 
        - type: battery_level
          entity: sensor.lumi_lumi_sensor_wleak_aq1_power
    binary_sensor.lumi_lumi_sensor_magnet_aq2_6b2b4205_on_off:
      properties:
        - type: open
          entity: binary_sensor.lumi_lumi_sensor_magnet_aq2_6b2b4205_on_off
        - type: battery_level
          entity: sensor.lumi_lumi_sensor_magnet_aq2_6b2b4205_power
    binary_sensor.lumi_lumi_sensor_magnet_aq2_c4702205_on_off:
      properties:
        - type: open
          entity: binary_sensor.lumi_lumi_sensor_magnet_aq2_c4702205_on_off
        - type: battery_level
          entity: sensor.lumi_lumi_sensor_magnet_aq2_c4702205_power
    binary_sensor.lumi_lumi_sensor_wleak_aq1_03580198_1_1280:
      properties:
        - type: water_leak
          entity: binary_sensor.lumi_lumi_sensor_wleak_aq1_03580198_1_1280
        - type: battery_level
          entity: sensor.lumi_lumi_sensor_wleak_aq1_03580198_1_1
    binary_sensor.lumi_lumi_sensor_wleak_aq1_cbcc5703_moisture:
      properties:
        - type: water_leak
          entity: binary_sensor.lumi_lumi_sensor_wleak_aq1_cbcc5703_moisture
        - type: battery_level
          entity: sensor.lumi_lumi_sensor_wleak_aq1_cbcc5703_power
    sensor.lumi_lumi_sen_ill_mgl01_3325773c_illuminance:
      properties:
        - type: illumination
          entity: sensor.lumi_lumi_sen_ill_mgl01_3325773c_illuminance
        - type: battery_level
          entity: sensor.lumi_lumi_sen_ill_mgl01_3325773c_power
    sensor.lumi_lumi_sens_48945e02_humidity:
      properties:
        - type: humidity
          entity: sensor.lumi_lumi_sens_48945e02_humidity
        - type: temperature
          entity: sensor.lumi_lumi_sens_48945e02_temperature
        - type: battery_level
          entity: sensor.lumi_lumi_sens_48945e02_power
    switch.lumi_lumi_plug_maeu01_fec8793c_on_off:
      properties:
        - type: power
          entity: sensor.lumi_lumi_plug_maeu01_electrical_measurement
        - type: voltage
          entity: sensor.iolka_rms_voltage
    light.lumi_lumi_relay_c2acn01_light:
      type: devices.types.switch
      properties:
        - type: power
          entity: sensor.lumi_lumi_relay_c2acn01_active_power
        - type: voltage
          entity: sensor.lumi_lumi_relay_c2acn01_rms_voltage
    sensor.lumi_lumi_sen_ill_mgl01_d952773c_illuminance:
      properties:
        - type: illumination
          entity: sensor.lumi_lumi_sen_ill_mgl01_d952773c_illuminance
        - type: battery_level
          entity: sensor.lumi_lumi_sen_ill_mgl01_d952773c_power
    sensor.lumi_lumi_sens_02fbebbd_1_1029:
      properties:
        - type: humidity
          entity: sensor.lumi_lumi_sens_02fbebbd_1_1029
        - type: temperature
          entity: sensor.lumi_lumi_sens_02fbebbd_1_1026
        - type: battery_level
          entity: sensor.lumi_lumi_sens_02fbebbd_1_1
    switch.tze200_hkdl5fmv_ts0601_switch:
      properties:
        - type: power
          entity: sensor.tze200_hkdl5fmv_ts0601_active_power
        - type: voltage
          entity: sensor.tze200_hkdl5fmv_ts0601_rms_voltage
        - type: amperage
          entity: sensor.tze200_hkdl5fmv_ts0601_rms_current
    sensor.lumi_lumi_sensor_ht_agl02_temperature:
      properties:
        - type: temperature
          entity: sensor.lumi_lumi_sensor_ht_agl02_temperature
        - type: humidity
          entity: sensor.lumi_lumi_sensor_ht_agl02_humidity
        - type: pressure
          entity: sensor.lumi_lumi_sensor_ht_agl02_pressure
    light.lumi_lumi_relay_c2acn01_2321e803_2:
      properties:
        - type: power
          entity: sensor.lumi_lumi_relay_c2acn01_2321e803_1_2820
    binary_sensor.lumi_lumi_sensor_wleak_aq1_0357ccbf_1_1280:
      type: devices.types.sensor.water_leak
      properties:
        - type: water_leak
          entity: sensor.lumi_lumi_relay_c2acn01_2321e803_1_2820
        - type: battery_level
          entity: sensor.lumi_lumi_sensor_wleak_aq1_0357ccbf_1_1
    sensor.lumi_lumi_sen_ill_mgl01_7625773c_illuminance:
      properties:
        - type: illumination
          entity: sensor.lumi_lumi_sen_ill_mgl01_7625773c_illuminance
        - type: battery_level
          entity: sensor.lumi_lumi_sen_ill_mgl01_7625773c_power
    water_heater.rmc_m800s_cooker:
      type: devices.types.cooking.multicooker


#mycroft:
#  host: speaker

telegram_bot:
  - platform: webhooks
    api_key: !secret telegram_api_key
    allowed_chat_ids:
      - 114122164
      - 1560910091

telegram_bot_conversation:

notify:
  - platform: html5
    name: html5
    vapid_pub_key: BA0ufUCAkPCSdEJBl2sStgZNOQicKJyEZnlTZvgPEOVG4HkJrafP7IcWHa-OSOON0EAAEUa9YoDqpPA-N3OCYVU
    vapid_prv_key: !secret web_push
    vapid_email: Shulyaka@gmail.com
  - platform: syslog
    name: syslog
#  - platform: mycroft
#    name: mycroft
  - platform: telegram
    name: telegram_114122164
    chat_id: 114122164
  - platform: telegram
    name: telegram_1560910091
    chat_id: 1560910091

shell_command:
  hassd_update: 'ssh shulyaka.org.ru /usr/lib/hassd/hassd_update.sh'
  hass_upgrade: ash -c "nohup /srv/homeassistant/upgrade.sh restart 0<&- &>/srv/homeassistant/www/upgrade_log.txt &"
  youtube_dl: 'ssh ananas /usr/local/bin/youtube_dl.sh -d "{{ callback }}" "{{ message }}"'

zha:
  database_path: /srv/homeassistant/zigbee.db
  zigpy_config:
    topology_scan_period: 20
    topology_scan_skip_coordinator: 1

media_player:
  - platform: universal
    name: Philips TV
    children:
      - media_player.philips_tv_2
      - media_player.philips_tv_3
  - platform: mpd
    host: speaker

media_extractor:

yandex_station:
  username: !secret yandex_username
  password: !secret yandex_password
  tts_service_name: alice_say

morph_numbers:

template:
  - sensor:
#    - name: "{{state_attr('sensor.wcounter', 'counters')[0].name.capitalize()}} counter"
#      unique_id: watercounter_0
#      unit_of_measurement: 'm³'
#      icon: mdi:speedometer
#      state: "{{'%.3f'|format(state_attr('sensor.wcounter', 'counters')[0].value/1000)}}"
#      attributes:
#        serial: "{{state_attr('sensor.wcounter', 'counters')[0].serial}}"
#        state: "{{'%d%%'|format(state_attr('sensor.wcounter', 'counters')[0].state*100/15)}}"
#        lastaction: "{{state_attr('sensor.wcounter', 'counters')[0].lastaction}}"
#        name: "{{state_attr('sensor.wcounter', 'counters')[0].name}}"
#    - name: "{{state_attr('sensor.wcounter', 'counters')[1].name.capitalize()}} counter"
#      unique_id: watercounter_1
#      unit_of_measurement: 'm³'
#      icon: mdi:speedometer
#      state: "{{'%.3f'|format(state_attr('sensor.wcounter', 'counters')[1].value/1000)}}"
#      attributes:
#        serial: "{{state_attr('sensor.wcounter', 'counters')[1].serial}}"
#        state: "{{'%d%%'|format(state_attr('sensor.wcounter', 'counters')[1].state*100/15)}}"
#        lastaction: "{{state_attr('sensor.wcounter', 'counters')[1].lastaction}}"
#        name: "{{state_attr('sensor.wcounter', 'counters')[1].name}}"
#    - name: "{{state_attr('sensor.wcounter', 'counters')[2].name.capitalize()}} counter"
#      unique_id: watercounter_2
#      unit_of_measurement: 'm³'
#      icon: mdi:speedometer
#      state: "{{'%.3f'|format(state_attr('sensor.wcounter', 'counters')[2].value/1000)}}"
#      attributes:
#        serial: "{{state_attr('sensor.wcounter', 'counters')[2].serial}}"
#        state: "{{'%d%%'|format(state_attr('sensor.wcounter', 'counters')[2].state*100/15)}}"
#        lastaction: "{{state_attr('sensor.wcounter', 'counters')[2].lastaction}}"
#        name: "{{state_attr('sensor.wcounter', 'counters')[2].name}}"
    - name: Backup watchdog
      unique_id: backup_watchdog_timer
      availability: "{{ is_state('light.sonoff_10013f38ac_1', 'on') }}"
      state: "{{ state_attr('automation.backup_watchdog', 'last_triggered') + timedelta(minutes=31) }}"
      device_class: timestamp
    - name: Backup1 watchdog
      unique_id: backup1_watchdog_timer
      availability: "{{ is_state('light.lumi_lumi_relay_c2acn01_light_2', 'on') }}"
      state: "{{ state_attr('automation.backup1_watchdog', 'last_triggered') + timedelta(minutes=31) }}"
      device_class: timestamp
  - trigger:
    - platform: event
      event_type: zha_event
      event_data:
        device_ieee: 00:13:a2:00:41:a0:7e:1a
        command: tp_command_response
    sensor:
      - name: "Humidifier Internal Temperature"
        unique_id: humidifier_internal_temperature
        state: '{{ trigger.event.data.args.response }}'
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement
  - trigger:
      - platform: time
        at: "5:49:10"
      - platform: time
        at: "8:49:10"
      - platform: time
        at: "15:49:10"
      - platform: time
        at: "19:49:10"
      - platform: time
        at: "21:49:10"
      - platform: homeassistant
        event: start
    sensor:
      - name: "Energy Tariff Zone"
        unique_id: mosenergosbyt_energy_tariff
        state: '{% if today_at("5:49:10") <= now() < today_at("8:49:10") or today_at("15:49:10") <= now() < today_at("19:49:10") -%}T1{%- elif today_at("21:49:10") <= now() or now() < today_at("5:49:10") -%}T2{%- else -%}T3{%- endif %}'
        attributes:
          description: '{% if today_at("5:49:10") <= now() < today_at("8:49:10") or today_at("15:49:10") <= now() < today_at("19:49:10") -%}Peak zone{%- elif today_at("21:49:10") <= now() or now() < today_at("5:49:10") -%}Night zone{%- else -%}Half-peak zone{%- endif %}'
          timespan: '{% if today_at("5:49:10") <= now() < today_at("8:49:10") or today_at("15:49:10") <= now() < today_at("19:49:10") -%}T107:00 - 10:00, 17:00 - 21:00{%- elif today_at("21:49:10") <= now() or now() < today_at("5:49:10") -%}23:00 - 07:00{%- else -%}10:00 - 17:00, 21:00 - 23:00{%- endif %}'
      - name: "Energy Cost"
        unique_id: mosenergosbyt_energy_cost
        state: "{% if states('sensor.energy_tariff')=='T1' -%}9.35{%- elif states('sensor.energy_tariff')=='T2' -%}2.98{%- elif states('sensor.energy_tariff')=='T3' -%}6.43{%- endif %}"
        unit_of_measurement: "₽/kWh"

sensor:
  - platform: rest
    resource: http://watercounter.atlantis/cgi-bin/wcounter.sh
    name: wcounter
    value_template: 'Available'
    device_class: signal_strength
    json_attributes: counters

command_line:
  - binary_sensor:
      command: 'git -C /srv/homeassistant/ status | grep -q "nothing to commit, working tree clean" && echo "OFF" || echo "ON"'
      name: Uncommitted changes
      device_class: problem
      unique_id: configuration_git_uncommitted_changes

#switch:
#  - platform: rest
#    resource: http://watercounter.atlantis/cgi-bin/wcontrol.sh?valve=hot
#    name: Hot water
#    body_on: '{"function": "open"}'
#    body_off: '{"function": "close"}'
#    is_on_template: '{{ value_json.lastaction == "open" }}'
#  - platform: rest
#    resource: http://watercounter.atlantis/cgi-bin/wcontrol.sh?valve=cold
#    name: Cold water
#    body_on: '{"function": "open"}'
#    body_off: '{"function": "close"}'
#    is_on_template: '{{ value_json.lastaction == "open" }}'
#  - platform: rest
#    resource: http://watercounter.atlantis/cgi-bin/wcontrol.sh?valve=toilet
#    name: Toilet water
#    body_on: '{"function": "open"}'
#    body_off: '{"function": "close"}'
#    is_on_template: '{{ value_json.lastaction == "open" }}'

#rest_command:
#  set_counter:
#    url: "http://watercounter.atlantis/cgi-bin/wcontrol.sh?function=set&valve={{name}}&value={{'%d'|format(value|float*1000)}}"
#  mos_ru_update:
#    url: "http://watercounter.atlantis/cgi-bin/mos_ru_update.sh"

climate:
  - platform: generic_thermostat
    name: Humidifier fan
    target_sensor: sensor.humidifier_pump_temperature
    heater: switch.humidifier_fan
    min_temp: 20
    max_temp: 40
    ac_mode: true

light:
  - platform: group
    name: Bathroom exhaust lamp
    unique_id: bathroom_exhaust_lamp
    entities:
      - light.hue_color_lamp_1
      - light.hue_color_lamp_5

moscow_pgu:
  username: !secret moscow_pgu_username
  password: !secret moscow_pgu_password
